---
title: http
date: 2017-02-20 18:52:24
tags: 
    - http 
commit: false 
categories: http 
---
### TCP/IP 协议族
- 应用层
    - 决定了向用户提供应用服务时通信的活动
    - FTP: 文件传输
    - DNS: 域名系统
    - HTTP: http协议请求 通信
- 传输层
    - 提供2台计算机直接的数据传输
    - TCP: 传输控制协议
    - UDP: 用户数据协议
- 网络层
    - 处理网络上流动的数据包
    - 在众多的选项内选择一条传输路线
    - IP协议：负责传输 是无状态的 
    - 传输成功与否在TCP协议中确认
- 链路层
    - 处理网络的硬件部分
    - 网卡 光纤 
<!--more-->

#### TCP协议
- 传输协议 基于字节流的传输通信协议
- 应用层之下 IP层之上
    - 应用层 》TCP 》IP
- 建立一个TCP链接 客户端和服务端要三次握手
    - SYN: synchronize ACK: acknowledgement
    - 1. client -> SYN标志的数据包 -> server
    - 2. server -> SYN/ACK确认信息 -> client
    - 3. client -> ACK的数据包 -> server
    
#### ip协议
- IP协议规定了数据传输时的基本单元和格式
    - 传输包装方式和大小
- IP协议还定义了数据包的递交办法和路由选择
    - 传输方法和路线
        
### DNS 应用层
* 浏览器中的URL通过DNS解析成IP
* DNS 服务器是集群是分层级的，没有任何一个单一的 DNS 服务器是中包含所有服务器
* 如果一个服务器没着到，会沿着节点一层一层往上找
* 每一个请求都是独立的无状态的

### HTTP 应用层
#### HTTP 通信
1. 客户端在应用层（HTTP）访问URL
2. 在传输层（TCP）把应用层的接受到的数据（HTTP报文请求），进行分割 并且打上标记（SYN ACK）转发给网络层
3. 网络层（IP）增加作为通信的目的地的MAC地址后发给链路层

#### HTTP 请求 和响应
##### request请求报文
```text
方法 URL/URI 协议版本
GET /search.html HTTP/1.1
```
##### 响应报文
```text
协议版本 状态码 描述
HTTP/1.1 200 ok
```
##### 请求响应头
- 通用头域 General
- 请求头 Request Headers
- 响应头 Response Headers
- 请求参数 Request PayLoad/Request body
- 返回结果

{% asset_img headers.png request header %}
        
##### 请求 Method
* GET 从服务器向客户端发送命名资源
* POST 将客户端数据发送到一个服务器网关应用程序
* OPTIONS 查询针对请求URI指定的资源支持的方法。
* DELETE 从服务器中删除命名资源
* PUT 将来自客户端的数据存储到一个命名的服务器资源中去
* HEAD 仅发送命名资源响应中的 HTTP 首部
* CONNECT 方法要求在代理服务器通信时建立隧道，实现隧道协议进行TCP通信。
* TRACE 方法是让WEB服务器端将之前的请求通信环回给客户端的方法。

##### 状态码
* 1XX 信息状态码 接受的请求正在处理
* 2XX 成功状态吗 请求正常处理完毕
* 3XX 重定向状态码 需要进行附加操作以完成请求
* 4XX 客户端错误状态码 服务器无法处理请求
* 5XX 服务器错误状态码 服务器处理请求出错

* 200 OK：请求正常处理。
* 204 No Content：请求正常处理，但没有资源可返回。
* 206 Partial Content： 客户端进行了范围请求，服务器成功执行这部分GET请求。
* 301 Moved Permanently： 永久性重定向，表明该资源已被分配了新的URI。
* 302 Found： 临时性重定向，表明该资源暂时被分配了新的URI。
* 303 See Other：表明请求的资源存在另一个URI，明确要求客户端采用GET方法重定向请求资源。
* 304 Not Modified : 未改变，使用缓存
* 400 Bad Request：请求报文中存在语法错误，需修改请求内容后再次发送。
* 401 Unauthorized\*：请求需包含通过HTTP认证（BASIC认证、DIGEST认证等）的认证信息，浏览器初次接收401响应会弹出认证窗口。若之前已进行过一次请求，则表示用户认证失败。
* 403 Forbidden：请求资源的访问被服务器拒绝。服务器端没有必要给出拒绝的详细理由，不过也可以在响应主体部分对原因进行描述。未获得文件系统的访问授权（比如在IIS上部署网站时默认不能通过浏览器访问文件）、访问权限出现问题（比如从未授权的发送源IP地址试图访问）都有可能返回403响应。
* 404 Not Found：服务器无法找到请求的资源（也可在服务器端拒绝访问且不想说明理由时使用）。
* 500 Internal Server Error：服务器端执行请求时发生内部错误。多为服务器端程序出现Bug。
* 503 Service Unavailable：服务器处于超负载或正在停机维护，暂时无法处理请求。

### WEB 的结构组件
- 代理
- 位于客户端和服务端中间
- 对请求和响应进行过滤等操作
- 缓存
- HTTP 仓库 使常用副本保存在离客户端更近的地方
- 网关
- 链接其他服务器的特殊 WEB 服务器
- HTTP <-(http)-> HTTP/FTP 网关 <-(FTP)-> FTP 服务器
- 隧道
- 对 HTTP 通信报文进行盲转发的特殊代理。
- Agent 代理
- 发起自动 HTTP 请求的半智能 Web 客户端。

### 一次url请求发生了什么
1. DNS解析
    1. 先缓存查找 -> 有返回
    2. 本地服务器 -> 根域名服务器 -> 有返回
    3. 根域名服务器 -> 顶级域名服务器 ->有返回
    4. 顶级域名服务器 -> 网址域名服务器 ->有返回
    5. 拿到ip 缓存ip
2. 拿到ip和服务器 建立TCP链接 
    - 三次握手 加入标识/识别标识 
    - 数据传输走IP协议
3. 浏览器向服务器发送一条 http 请求报文
    - 请求行 请求头 请求正文
4. 服务器返回给浏览器一条 HTTP 响应报文 
    - 状态码 响应头 响应报文
    - 状态码
5. 浏览器接收HTML, CSS, JS 渲染页面
    - 渲染引擎
        - HTML构建DOM
        - CSS计算样式构建渲染
        - 浏览器开始渲染
            - 重排和重绘
    - js引擎
        - 解析执行js 
        - 会阻塞 挂起渲染
    - 浏览器下载资源不会阻塞

    